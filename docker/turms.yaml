services:
  discovery:
    image: ghcr.io/turmsapp/discovery:0.1.0
    container_name: discovery
    restart: always
    depends_on:
      - postgres
    expose:
      - 4000
    environment:
      DATABASE_URL: ecto://postgres:postgres@postgres:5432/turms
      SECRET_KEY_BASE: # mix phx.gen.secret
      POOL_SIZE: 15
      PHX_HOST: localhost
      PORT: 4000
    networks:
      - database

  turn:
    image: ghcr.io/turmsapp/turn:0.1.1
    container_name: turn
    restart: always
    depends_on:
      - otel-collector
    expose:
      - 3478
      - 3478/udp
    environment:
      - PORT=3478
      - REALM=turn
      - JWT_ALGORITHM=ES256
      - JWT_PUBLIC_KEY=/bin/jwt.pub
      - OTEL_URL=otel-collector:4317
    networks:
      - telemetry
